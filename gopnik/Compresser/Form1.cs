using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.IO.Compression;
using System.IO;

namespace Compresser
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            textBox1.Text = UTF8Encoding.Default.GetString(XorCrypt(UTF8Encoding.Default.GetBytes(textBox1.Text), "key")); 
        }

        byte[] Compress(byte[] arr_bData)
        {
            using (MemoryStream msInput = new MemoryStream(arr_bData))
            {
                using (MemoryStream msOutput = new MemoryStream())
                {
                    using (GZipStream zsStream = new GZipStream(msOutput, CompressionMode.Compress))
                    {
                        msInput.WriteTo(zsStream);
                    }
                    return msOutput.ToArray();
                }
            }
        }

        byte[] Decompress(byte[] arr_bData)
        {
            using (MemoryStream msInput = new MemoryStream(arr_bData))
            {
                using (MemoryStream msOutput = new MemoryStream())
                {
                    using (GZipStream zsStream = new GZipStream(msInput, CompressionMode.Decompress))
                    {
                        int iRead = 0;
                        byte[] arr_bBuffer = new byte[8192];
                        do
                        {
                            iRead = zsStream.Read(arr_bBuffer, 0, arr_bBuffer.Length);

                            if (iRead > 0) msOutput.Write(arr_bBuffer, 0, iRead);
                        } while (iRead > 0);
                        return msOutput.ToArray();
                    }
                }
            }
        }

        byte[] XorCrypt(byte[] arr_bData, string strKey)
        {
            byte[] arr_bKey = UTF8Encoding.Default.GetBytes(strKey);

            for (int i = 0; i < arr_bData.Length; i++)
            {
                foreach(byte bKey in arr_bKey)
                    arr_bData[i] ^= bKey;
            }
            return arr_bData;
        }

        private void button2_Click(object sender, EventArgs e)
        {
            textBox1.Text = UTF8Encoding.Default.GetString(XorCrypt(UTF8Encoding.Default.GetBytes(textBox1.Text), "key"));
        }

        private void Form1_Load(object sender, EventArgs e)
        {

        }
    }
}
