using System;
using System.Collections.Generic;
using System.Text;
using System.IO;
using System.IO.Compression;

namespace Builder.Utilities
{
    class CUtils
    {
        private static Random _rRandom = new Random();

        public static int RandomInt(Int32 iMin, Int32 iMax)
        {
            return _rRandom.Next(iMin, iMax);
        }

        public static String RandomString(Int32 iLength)
        {
            char[] arr_cChars = "abcdefghijklmnopqrstuvzxywABCDEFGHIJKLMNOPQRSTUVZXYW".ToCharArray();

            String strOut = String.Empty;

            while (strOut.Length != iLength)
                strOut += arr_cChars[RandomInt(0, arr_cChars.Length)];

            return strOut;
        }

        public static byte[] Compress(byte[] arr_bData)
        {
            using (MemoryStream msInput = new MemoryStream(arr_bData))
            {
                using (MemoryStream msOutput = new MemoryStream())
                {
                    using (GZipStream zsStream = new GZipStream(msOutput, CompressionMode.Compress))
                    {
                        msInput.WriteTo(zsStream);
                    }
                    return msOutput.ToArray();
                }
            }
        }

        public static byte[] Decompress(byte[] arr_bData)
        {
            using (MemoryStream msInput = new MemoryStream(arr_bData))
            {
                using (MemoryStream msOutput = new MemoryStream())
                {
                    using (GZipStream zsStream = new GZipStream(msInput, CompressionMode.Decompress))
                    {
                        int iRead = 0;
                        byte[] arr_bBuffer = new byte[8192];
                        do
                        {
                            iRead = zsStream.Read(arr_bBuffer, 0, arr_bBuffer.Length);

                            if (iRead > 0) msOutput.Write(arr_bBuffer, 0, iRead);
                        } while (iRead > 0);
                        return msOutput.ToArray();
                    }
                }
            }
        }

        public static byte[] XorCrypt(byte[] arr_bData, string strKey)
        {
            byte[] arr_bKey = UTF8Encoding.Default.GetBytes(strKey);

            for (int i = 0; i < arr_bData.Length; i++)
            {
                foreach (byte bKey in arr_bKey)
                    arr_bData[i] ^= bKey;
            }
            return arr_bData;
        }
    }
}
